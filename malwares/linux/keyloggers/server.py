import socket
import ssl

def run_secure_server():
    context = ssl.create_default_context(ssl.Purpose.CLIENT_AUTH)
    context.load_cert_chain(certfile='server.crt', keyfile='server.key')

    bindsocket = socket.socket()
    bindsocket.bind(('0.0.0.0', 1234))
    bindsocket.listen(5)
    print("[*] Server is listening on port 1234")

    while True:
        newsocket, fromaddr = bindsocket.accept()
        print(f"[+] Connection from {fromaddr}")
        connstream = context.wrap_socket(newsocket, server_side=True)

        try:
            data = connstream.recv(1024)
            print("[>] Received:", data.decode(errors="ignore"))
        except Exception as e:
            print("[!] Error:", e)
        finally:
            connstream.close()

run_secure_server()
